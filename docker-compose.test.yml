# Docker Compose конфигурация для запуска интеграционных тестов
# Использование: docker-compose -f docker-compose.test.yml up --build --abort-on-container-exit

services:
  postgres_test:
    image: postgres:16-alpine
    container_name: reviewservice-postgres-test
    environment:
      POSTGRES_USER: reviewservice_test
      POSTGRES_PASSWORD: test_password
      POSTGRES_DB: reviewservice_test
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U reviewservice_test"]
      interval: 3s
      timeout: 3s
      retries: 5

  test_runner:
    build:
      context: .
      dockerfile: Dockerfile.test
    environment:
      TEST_DB_HOST: postgres_test
      TEST_DB_PORT: 5432
      TEST_DB_USER: reviewservice_test
      TEST_DB_PASSWORD: test_password
      TEST_DB_NAME: reviewservice_test
    depends_on:
      postgres_test:
        condition: service_healthy
    command: go test -v ./tests/integration/...

